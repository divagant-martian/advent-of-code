use std::{collections::BTreeSet, str::FromStr};

use atlas::Scanner;

mod atlas;

fn main() {
    let input = "
        --- scanner 0 ---
801,940,813
620,888,825
987,567,-489
-283,662,455
64,125,-67
-556,-453,660
898,-661,-511
878,634,-457
-362,870,-789
696,-414,521
725,892,765
-683,-735,-482
615,-408,505
-642,-411,520
630,-364,389
-353,635,442
-357,783,-710
-730,-720,-602
906,720,-516
965,-768,-610
-302,752,-719
171,57,78
-707,-337,671
-367,646,507
-661,-699,-444
983,-703,-484

--- scanner 1 ---
713,-349,676
-661,858,-701
-457,-818,-388
-777,406,868
131,44,40
809,729,963
730,657,-509
669,630,-449
-616,-700,464
-731,840,-632
-522,-902,-289
-658,-675,432
564,670,-425
-644,854,-758
820,702,771
-667,345,799
-35,-108,163
-711,394,752
707,-384,701
658,-344,518
-695,-694,667
414,-423,-685
537,-430,-625
-514,-883,-554
465,-431,-784
817,840,812

--- scanner 2 ---
608,227,-767
-12,-4,131
631,736,790
675,687,743
741,675,859
-705,451,-458
625,223,-710
-856,379,762
-920,-664,-450
-807,-699,-556
624,-812,-468
-766,424,-518
-497,-916,765
-522,-855,743
745,-831,-541
-118,-134,14
-845,352,954
641,-845,892
652,-793,827
-442,-752,745
765,-824,935
695,241,-641
-853,241,803
738,-724,-511
-770,-659,-382
-600,411,-434

--- scanner 3 ---
-774,631,-744
837,784,-657
-284,-752,796
-487,493,544
719,646,659
806,-758,506
795,605,674
-739,-588,-321
607,-516,-521
-634,-613,-432
-745,670,-843
704,710,-587
739,-738,424
-445,-727,788
-512,620,407
96,136,85
600,600,732
660,-640,-487
-510,509,546
-6,-10,-31
743,-696,500
-765,707,-787
-420,-801,800
-505,-612,-292
720,730,-723
583,-587,-623

--- scanner 4 ---
-508,-795,-648
-610,784,878
-643,312,-527
-622,734,857
-572,301,-539
844,333,906
751,-584,-659
658,-616,-729
-590,-904,-645
-625,-637,581
615,336,-413
635,342,-402
102,-52,82
925,350,741
708,-918,615
-529,-765,-626
583,-538,-726
-546,823,817
463,330,-476
683,-883,621
766,342,787
-617,480,-596
-708,-618,458
866,-923,670
-665,-714,601

--- scanner 5 ---
762,461,819
939,-581,-807
749,-487,-802
-539,-341,611
787,410,-483
-528,-484,-727
-534,612,570
-486,515,545
-673,-468,-785
674,508,712
-481,-460,-841
-657,576,516
374,-504,588
-742,412,-631
-622,-344,624
-700,487,-610
-521,-367,705
483,-416,687
28,-36,-43
455,-453,549
768,446,-452
768,498,886
764,298,-576
-733,628,-577
884,-513,-811

--- scanner 6 ---
400,661,-364
422,699,-400
-680,-700,642
851,-688,587
-681,-648,731
649,832,902
-445,-631,-799
-381,-732,-742
513,-700,-531
-500,478,-629
659,783,889
-442,554,-680
-802,316,774
-740,-681,584
746,-681,489
353,541,-379
-343,-604,-649
-916,345,790
711,-611,600
531,-814,-643
722,627,916
21,-101,25
620,-763,-501
-717,338,814
-106,39,106
-504,657,-650

--- scanner 7 ---
457,-470,383
-799,-448,619
526,-588,-697
-468,-362,-697
-759,-631,668
474,-389,548
-443,-394,-655
-241,359,-561
626,631,571
809,639,593
466,-548,502
-449,-597,-734
643,751,573
671,348,-446
-260,624,-553
-794,-606,674
-712,854,426
667,360,-603
-325,458,-496
-720,755,375
415,-471,-686
172,28,67
500,-568,-686
14,-114,65
803,304,-499
-713,695,498

--- scanner 8 ---
762,-352,345
-40,104,34
572,-411,322
-709,781,-567
-702,-405,450
-539,511,638
597,-264,330
782,-791,-442
612,471,-350
674,-678,-473
-603,894,-602
592,416,-514
-535,744,-607
-100,-39,-70
634,689,634
-598,475,632
-664,-764,-542
-453,-402,455
739,-667,-421
590,496,-411
-694,-771,-435
-621,-650,-454
-514,470,597
-553,-324,471
641,603,759
682,763,704

--- scanner 9 ---
306,-809,653
-748,-517,723
563,-536,-494
-650,649,-755
470,-864,633
-473,716,424
-678,-591,675
300,701,-546
-707,653,-913
523,-499,-668
394,786,361
-155,-52,-96
-581,746,492
398,838,421
-641,-810,-473
558,-386,-562
-583,619,-918
-682,-769,-498
-803,-677,682
3,51,-50
309,527,-652
387,866,524
-569,810,405
367,-784,631
-676,-805,-557
291,559,-691

--- scanner 10 ---
500,730,715
-512,600,-593
887,-817,496
-623,775,716
-415,-624,409
666,564,-358
61,-100,88
-530,705,748
-698,772,794
486,796,815
612,-552,-592
528,-718,-605
570,801,641
-598,-575,449
-668,-462,-637
-860,-473,-664
593,488,-448
788,-868,488
-709,-465,-775
728,-745,495
-573,-569,414
-501,756,-610
552,-613,-565
559,568,-266
-462,580,-683

--- scanner 11 ---
-309,-696,693
387,-401,-669
-584,-384,-829
-732,601,410
-372,792,-785
665,665,570
763,-513,718
620,-478,694
-371,685,-777
-333,-549,769
497,700,523
556,-463,-602
-631,-398,-818
-287,-605,682
-745,457,510
608,637,-590
464,-398,-561
-671,647,503
-53,-41,-59
497,-514,694
618,687,-754
-600,-547,-755
-458,754,-739
654,732,-712
453,656,615

--- scanner 12 ---
372,532,360
639,489,-773
-752,-373,385
-452,-478,-778
369,-586,704
-386,424,-726
-748,-422,249
-740,-447,410
569,-658,-642
-615,446,506
-599,372,343
108,-129,-66
541,599,422
-376,-436,-774
-473,462,-795
-38,24,-32
449,640,357
-646,383,357
-387,416,-833
603,447,-728
535,-534,-695
-458,-416,-841
340,-562,470
480,-561,599
593,611,-678
671,-587,-618

--- scanner 13 ---
-681,-444,-607
-759,305,789
660,-375,472
-760,464,717
803,-332,505
-440,706,-824
462,686,-769
475,-436,-333
371,642,-812
532,-358,-326
762,520,622
-671,-577,-763
34,-114,-80
-614,622,-829
-369,-352,713
596,408,642
-43,-12,42
-540,692,-758
579,528,644
352,622,-711
530,-398,-381
-509,-421,766
778,-423,508
-767,404,840
-367,-432,701
-696,-515,-617

--- scanner 14 ---
-406,-409,768
-851,263,645
670,578,-625
-390,-794,-693
-784,370,546
-582,617,-486
-325,-493,743
738,-791,-847
-869,328,519
61,-103,74
756,620,-485
821,694,-636
844,311,637
-306,-729,-792
-501,623,-470
-516,667,-354
-325,-737,-527
475,-984,551
-360,-473,625
606,-844,-803
548,-970,346
538,-957,395
797,296,517
602,-687,-791
775,332,479

--- scanner 15 ---
223,371,655
-17,-102,-128
-769,565,685
-728,308,-669
484,-478,-525
-464,-619,-619
258,516,-525
464,-452,-536
325,-683,843
-901,499,735
-408,-755,-723
-463,289,-661
-452,-623,-776
-562,373,-726
226,340,702
-770,-773,688
-785,484,691
367,-367,-536
-167,-74,8
329,284,612
493,497,-488
-630,-687,646
534,-754,847
346,-720,772
290,491,-567
-619,-838,762

--- scanner 16 ---
-603,847,502
502,-304,-487
498,512,-878
426,353,-877
7,69,-157
-499,903,638
-306,-495,375
100,-68,-25
-797,-687,-425
-496,749,-490
-320,-290,448
571,576,461
593,568,644
-561,848,-406
710,-284,685
707,-375,660
375,452,-885
-333,-339,438
514,-384,-485
743,-327,542
573,456,478
-881,-712,-506
-817,-569,-460
449,-373,-627
-553,583,-425
-446,859,506

--- scanner 17 ---
-803,753,-681
482,-607,645
-2,-14,-9
-713,-509,535
530,-808,-516
690,701,442
585,828,382
-618,-555,657
417,-699,686
-635,-613,-488
-741,604,544
-668,-545,493
554,716,-702
659,-668,-515
699,748,-748
764,-779,-540
-717,571,337
-582,-579,-612
-665,773,-545
-771,665,352
420,-776,578
-686,745,-531
-558,-477,-541
685,745,-830
672,824,531

--- scanner 18 ---
252,457,679
745,-871,-463
295,600,712
463,767,-337
-619,-593,-531
-381,-549,-542
633,-683,774
795,-707,720
752,-672,-439
-608,681,540
-600,498,562
-732,-790,520
-77,114,76
-935,504,-530
-488,664,542
307,704,-364
-879,640,-634
-668,-710,625
-577,-755,621
258,694,-351
-891,636,-477
-457,-478,-548
343,482,676
33,-71,-5
803,-684,793
774,-757,-479

--- scanner 19 ---
-405,-715,587
364,-869,-720
-369,711,-581
-432,-625,497
-450,-623,600
-463,656,-608
414,-848,-732
42,-94,-11
806,411,525
-719,569,678
-728,-476,-459
836,536,-753
325,-808,-656
-787,571,781
-791,-587,-480
812,422,505
668,605,-727
818,485,353
-461,734,-497
806,-778,656
815,-897,734
-900,-460,-527
-747,520,839
798,-732,815
847,548,-682

--- scanner 20 ---
415,644,-892
-728,765,-806
-550,-764,325
78,14,39
698,-752,-507
-570,-663,306
-788,888,-813
598,595,-852
-500,-710,-586
530,-685,-553
666,-439,367
515,761,373
356,715,381
573,589,-887
-784,690,550
437,880,364
-486,-776,-486
818,-502,361
-570,-781,-660
-887,837,-805
623,-755,-585
-65,128,-70
-664,692,533
-506,-721,416
646,-428,373
-672,670,716

--- scanner 21 ---
-625,719,839
832,518,718
876,-652,639
-438,-756,-679
942,405,-645
566,517,742
85,11,60
-405,-732,-886
-658,657,-692
-535,675,-781
711,-683,-730
-499,-786,-871
664,-661,594
-662,570,-841
865,402,-537
709,482,718
143,-89,-122
-418,-751,612
-428,-807,695
832,-696,547
-670,745,785
773,467,-578
-456,732,723
721,-633,-566
-406,-781,784
675,-728,-688

--- scanner 22 ---
-368,311,-273
-673,-455,-217
-719,-598,-281
803,594,-627
500,479,792
774,533,-456
-754,311,535
614,-349,-491
433,516,798
770,-435,485
632,-398,513
749,630,-504
-210,-704,520
607,526,704
-722,514,562
-294,331,-444
-295,-677,562
-611,394,592
708,-323,-509
-325,364,-297
695,-326,-592
150,24,123
-754,-480,-301
731,-486,404
-228,-578,455

--- scanner 23 ---
79,35,108
-536,-482,-465
486,-414,487
-105,82,23
-653,-543,690
716,381,-669
-600,-564,799
686,697,402
-512,292,-691
-604,-356,-560
-579,401,-723
743,840,319
823,314,-570
765,-546,-390
758,296,-696
-374,589,523
-390,812,488
574,-521,534
874,-645,-478
480,-347,524
-644,-596,658
8,-101,-48
793,-684,-427
-465,-371,-431
-665,373,-664
716,808,522
-431,723,469

--- scanner 24 ---
-638,440,-740
-530,-457,-634
353,-251,-638
454,-232,-618
402,791,581
-602,530,721
-479,619,703
396,-342,-682
784,-410,402
-558,-742,716
336,734,-618
839,-412,362
19,161,91
341,560,-702
558,801,448
-558,-443,-655
548,816,519
57,-16,-27
832,-355,440
-699,632,-710
-475,470,616
-550,-593,-772
407,660,-688
-732,425,-686
-587,-614,585
-101,126,-64
-555,-660,730

--- scanner 25 ---
348,416,486
484,-581,-433
-392,-530,-995
510,775,-955
-715,552,-909
-396,-826,583
-417,-736,589
548,-690,663
466,-687,772
-547,617,256
-710,588,-895
-678,422,-876
446,836,-916
-394,-767,733
-610,572,305
-429,-640,-849
431,539,505
439,-638,-612
434,815,-866
413,-569,-444
391,559,582
-522,640,403
-65,17,-107
527,-668,633
-367,-515,-784

--- scanner 26 ---
500,-631,852
32,-125,33
622,673,585
521,-789,783
-466,598,354
-768,-873,546
559,-722,-776
-304,-525,-317
-220,-500,-398
188,51,63
-479,521,494
-300,319,-746
652,610,692
-795,-717,483
589,349,-460
764,724,674
532,266,-317
559,469,-349
452,-623,-843
485,-751,805
-368,591,459
-447,286,-777
-781,-922,556
-284,-643,-352
-276,266,-703
517,-749,-861
    ";
    let input_c = "
--- scanner 0 ---
579,799,416
48,82,-27
474,-502,534
652,-594,511
-609,574,-469
352,-544,-666
-780,740,353
-33,-102,-83
384,-640,-624
470,-559,544
468,864,533
670,759,-677
-700,873,335
-747,-486,-412
349,-584,-782
-382,-890,249
-567,658,-522
-689,659,-426
531,820,-584
-738,-569,-457
-369,-772,414
-816,800,310
601,763,-473
355,790,421
-629,-538,-431
-387,-903,381

--- scanner 1 ---
961,715,-541
-390,653,-337
475,-505,-519
-398,393,554
-543,-651,892
917,-691,745
-333,512,638
-447,-609,924
949,600,-504
-487,-493,927
959,652,536
860,-802,675
425,-583,-486
31,89,-38
856,-598,606
-729,-629,-505
-381,635,-466
-728,-658,-697
940,447,580
423,-556,-430
921,566,529
-385,763,-451
82,-46,86
863,628,-559
-792,-638,-728
-441,535,654

--- scanner 2 ---
-619,-740,-444
284,732,-285
349,769,-397
-800,371,856
-154,-142,35
-588,-753,-593
433,-771,646
426,648,604
-469,-701,964
-436,-703,873
-831,445,878
-68,-35,148
433,-910,547
321,677,-474
658,-831,-735
-708,471,-612
532,743,654
-599,-758,926
543,-753,-648
445,-815,-781
-682,-685,-597
491,-773,545
-814,389,-621
-712,458,817
-726,309,-547
422,838,592

--- scanner 3 ---
-742,640,493
468,610,-347
-656,680,388
533,814,631
-501,744,-596
472,-555,-383
-55,12,40
603,-399,668
-422,891,-618
-505,-699,597
-520,646,478
-523,-607,-421
-487,-491,600
479,-501,677
475,661,-559
428,770,510
-526,-596,-325
443,-605,-422
374,-553,-286
548,-425,783
-570,841,-566
-401,-666,575
605,756,519
469,566,-488
-494,-573,-565

--- scanner 4 ---
-24,-9,-13
693,825,-612
-659,674,730
726,696,493
-602,-470,716
-548,804,-616
-273,-440,-429
755,920,-722
591,-810,463
104,132,31
-798,656,824
701,-689,-711
-566,-637,674
800,-828,-711
901,636,510
-548,-422,677
592,-714,585
-775,678,794
-336,-418,-360
906,716,416
-738,825,-594
-360,-472,-355
-647,851,-605
802,-691,-653
743,730,-718
676,-767,543

--- scanner 5 ---
295,-829,-370
-646,-497,-795
785,-566,682
331,-823,-362
396,624,-653
-345,390,-837
-854,-521,625
-776,-569,671
-719,302,694
775,-608,710
618,434,807
613,-547,645
-691,-468,-758
-857,329,748
366,768,-662
-46,-127,-7
-368,546,-822
-855,-613,723
477,-938,-370
727,347,755
803,431,840
-390,421,-837
-915,322,743
-713,-449,-683
322,664,-548

--- scanner 6 ---
-478,-795,-399
636,601,800
475,790,-480
399,-509,961
48,51,76
-372,687,518
429,-773,-421
-854,749,-409
-751,809,-318
379,-786,-305
-764,-417,427
-712,-535,446
552,-546,960
-809,832,-531
653,710,892
483,781,-545
-104,95,187
378,-509,931
-505,589,580
-681,-426,472
499,783,-725
-347,-777,-366
452,-886,-397
-360,-782,-234
720,662,828
-418,474,502

--- scanner 7 ---
-747,-527,-295
-383,523,528
722,-666,942
622,-640,-526
-722,-449,-374
822,-614,982
531,486,601
-473,-615,807
658,-592,-519
546,512,-555
801,-857,967
-487,406,-646
-20,-36,160
-491,411,-601
596,468,439
550,606,-623
-705,-445,-317
636,-516,-380
699,575,-610
-472,-687,821
522,380,519
-563,527,518
-336,449,-620
-74,-172,0
-502,-611,738
-473,453,641

--- scanner 8 ---
-325,277,621
-346,432,631
648,-738,463
-284,-886,-509
610,-583,-878
429,537,390
-366,-908,-467
661,-654,541
567,-557,-727
605,-763,488
-379,-707,832
583,609,339
823,713,-542
888,705,-461
-262,393,-504
458,674,373
-329,-650,646
572,-602,-723
-237,503,-467
-288,-829,-492
-5,6,-132
-386,307,509
-383,-599,733
99,-170,-55
-249,384,-440
830,694,-667

--- scanner 9 ---
597,-475,-339
821,675,845
-364,-312,543
414,576,-313
743,721,797
-328,-320,537
-749,800,-693
386,653,-405
-661,726,-773
-95,72,62
-643,791,-611
-647,-638,-624
822,773,753
-735,-677,-711
613,-745,869
658,-708,898
487,-413,-244
491,-425,-434
-646,695,819
349,464,-350
-510,-320,428
-818,732,800
680,-633,917
-766,-699,-637
74,149,-8
-808,760,758

--- scanner 10 ---
671,-555,-655
672,548,433
-684,363,-477
628,600,354
720,502,355
792,-806,496
397,393,-396
-438,403,762
-573,-435,-449
-475,291,827
397,400,-473
434,477,-433
-559,-598,685
-464,-648,579
-625,390,-456
657,-513,-539
773,-881,518
-653,-440,-543
744,-918,563
-672,386,-603
-147,-172,17
647,-507,-645
-369,-586,689
-530,480,790
-593,-615,-526
-35,-50,-86

--- scanner 11 ---
-708,-978,-663
715,-781,-742
680,759,-622
-262,303,742
819,750,-718
-406,333,733
881,-642,685
-701,-920,-668
654,-831,-823
557,760,713
565,725,753
940,-709,735
-683,664,-675
933,-652,865
162,-1,80
-484,-431,902
-599,740,-760
-596,555,-727
763,-827,-746
-366,259,628
-609,-453,917
-728,-782,-614
-640,-408,917
463,792,860
30,-171,-39
742,714,-656

--- scanner 12 ---
-557,-594,-751
535,-288,-328
522,-780,851
577,462,-599
-378,644,873
506,-435,-371
562,-830,712
490,514,-708
-404,624,-594
620,-862,805
30,-32,-49
-485,-641,-711
-470,546,874
445,575,738
442,-439,-322
-423,587,-766
-722,-561,777
-794,-556,932
472,521,876
-426,598,795
-666,-473,931
465,526,934
-41,29,133
-673,-676,-778
-465,559,-756
574,429,-784

--- scanner 13 ---
-512,-780,-383
-634,-328,271
850,517,723
409,-606,298
-639,-724,-396
380,-651,335
100,-55,35
-752,362,545
735,371,731
739,589,-529
-411,665,-757
656,-371,-623
827,524,-467
708,-458,-468
833,537,-431
-488,714,-796
-610,-752,-415
749,-364,-620
-509,-350,256
-478,-305,256
-856,406,431
361,-673,410
741,335,723
-436,839,-789
22,58,-107
-712,436,440

--- scanner 14 ---
-460,675,-680
431,-518,-720
410,-453,-630
546,395,-372
-809,-922,-637
-476,-447,567
-385,609,-563
-679,-919,-628
496,378,-277
481,-504,704
-668,-866,-537
401,-490,-849
-432,672,-630
606,-464,582
711,311,823
-589,487,725
848,340,840
2,45,75
-564,530,750
559,334,-368
783,465,874
-533,-497,381
-480,543,672
-425,-501,480
451,-443,592
95,-118,129

--- scanner 15 ---
901,-715,774
-447,800,-713
-499,-598,656
-530,755,-704
613,743,-575
-57,-132,9
863,-629,781
859,628,565
383,-740,-702
563,-720,-625
698,786,-655
388,-660,-608
802,739,635
-499,781,-595
-391,-575,672
-415,-629,-674
-438,-641,-548
697,690,-533
-545,430,383
-442,-688,-695
882,-510,730
-505,546,386
-456,-456,756
798,535,704
100,-5,81
-601,588,418

--- scanner 16 ---
645,-660,-815
686,-400,877
-788,541,-551
-582,-777,-582
549,-417,906
-726,-490,687
0,107,10
-169,-72,58
621,-366,752
-751,-515,730
800,-659,-703
-545,700,768
725,515,512
-482,-755,-724
-571,851,725
-816,457,-490
737,678,-369
557,694,-371
-648,-739,-637
717,434,447
-642,-568,674
-880,524,-442
585,-617,-730
706,640,505
492,702,-362
-590,696,763

--- scanner 17 ---
-786,419,-780
580,542,522
-753,-461,678
-671,506,-702
660,-476,-725
-723,-515,665
491,710,-689
-659,-635,-482
460,561,-702
4,11,-37
-133,118,35
-477,757,820
-550,-652,-390
-828,-586,678
-449,680,728
554,557,-634
598,607,360
539,-552,439
686,533,440
-412,869,783
617,-325,-699
543,-372,449
613,-462,562
-598,-719,-454
-573,373,-764
655,-480,-680

--- scanner 18 ---
-626,741,779
-621,839,736
870,-429,299
-329,-456,-530
-481,-415,-436
474,-784,-723
769,358,-552
-484,-508,-443
862,-314,445
72,37,-49
707,453,-662
-564,805,649
862,-423,263
-328,-337,452
757,548,-556
437,-755,-678
544,738,582
-292,-331,465
483,751,701
-633,427,-669
-390,-425,517
505,825,670
-724,453,-680
-534,474,-658
549,-803,-745

--- scanner 19 ---
885,-364,-767
-758,-757,-795
-620,501,549
-808,378,-727
-652,-436,692
-654,530,693
563,-461,767
-36,-26,43
-602,-465,731
-643,533,789
754,-346,-734
81,100,-56
697,508,518
614,-468,555
541,493,-604
-818,-793,-838
484,497,-614
872,-359,-899
-882,491,-615
-891,-677,-813
519,-462,626
-817,602,-732
844,429,496
576,675,-637
-600,-367,828
794,577,548

--- scanner 20 ---
521,799,641
-814,-478,803
564,734,-498
-816,-536,666
-505,755,-478
416,854,546
-715,-478,664
626,864,-562
446,818,519
346,-834,447
322,-829,393
633,-584,-876
-483,786,-552
-488,391,596
724,-595,-850
-397,424,594
534,-573,-829
621,821,-464
-544,667,-565
-757,-471,-755
-47,63,-74
259,-760,415
-707,-577,-850
-435,554,651
-769,-467,-945

--- scanner 21 ---
693,-762,-734
616,828,628
-684,-626,636
-595,479,-482
-383,525,-446
674,-607,-772
-568,-625,-730
-392,572,557
782,844,715
682,866,573
-445,-535,-656
-363,646,506
448,-368,481
56,54,26
-671,-572,606
-72,160,-43
513,604,-739
538,579,-696
476,-452,542
-684,-501,711
384,-435,433
-455,-715,-660
-471,488,-412
622,657,-683
-315,512,408
719,-611,-777

--- scanner 22 ---
-426,-460,-817
430,-548,757
17,-21,65
645,-446,-810
-502,-376,-732
702,-493,-691
312,721,-517
477,-544,865
283,-543,859
-616,518,-622
676,-492,-734
332,738,-554
-96,88,-105
-863,-797,685
-934,800,393
-454,579,-687
498,874,776
-752,909,393
-611,-463,-784
473,807,749
535,829,715
-898,794,385
369,646,-663
-444,537,-659
-907,-693,571
-833,-653,676

--- scanner 23 ---
614,503,499
-741,-573,-430
666,496,-326
586,590,-331
-874,485,504
70,134,-24
-764,665,-640
709,-743,589
-855,603,556
-860,543,-641
-739,-631,-531
680,-638,-489
-799,-406,850
870,-642,-477
-67,-30,81
801,-715,512
-878,-631,-432
-783,-619,896
764,-780,400
567,650,495
-829,494,587
555,524,472
-817,623,-556
646,573,-506
775,-532,-539
-721,-521,763

--- scanner 24 ---
-804,350,366
456,-494,-642
363,-619,389
-411,-594,552
261,606,745
284,599,-445
341,-681,423
372,534,-507
278,586,-409
-878,381,388
-1,-117,40
-791,469,427
-127,5,-73
-670,-495,-397
435,-446,-785
543,-509,-828
-403,-518,594
-734,-428,-464
296,-644,362
-858,402,-681
376,752,753
-849,-457,-445
-892,315,-738
370,788,745
-794,272,-743
-418,-406,604

--- scanner 25 ---
86,149,-150
-572,-670,-518
748,-704,-522
569,-536,361
-723,-522,310
563,566,-778
-419,589,553
-665,-309,333
-597,-464,-470
829,-696,-457
739,901,432
806,837,480
561,-471,352
-628,-622,-575
722,809,541
-623,602,-609
585,-716,359
623,-685,-515
-470,657,-672
-474,589,-578
412,592,-735
-286,527,455
1,56,27
567,611,-773
-332,511,668
-768,-400,393";

    let mut scanners = input
        .trim()
        .split("\n\n")
        .map(Scanner::from_str)
        .collect::<Result<Vec<Scanner>, _>>()
        .unwrap();
    let total = join_scanners(&mut scanners);
    // assert_eq!(scanners.len(), 1);
    let mut max_distance = 0;
    for i in 0..scanners.len() {
        for j in i + 1..scanners.len() {
            let diff = (scanners[i].origin() - &scanners[j].origin()).norm();
            max_distance = max_distance.max(diff);
        }
    }

    println!("Max distnace {}", max_distance);
    assert_eq!(total.len(), 79);
}

fn join_scanners(scanners: &mut Vec<Scanner>) -> Scanner {
    let mut already_joined = BTreeSet::from([0usize]);
    let mut total = scanners[0].clone();
    while already_joined.len() < scanners.len() {
        'outer: for &i in &already_joined {
            for j in 0..scanners.len() {
                if !already_joined.contains(&j) {
                    if let Some(new) = scanners[i].big_matches(&scanners[j]) {
                        total += new.clone();
                        scanners[j] = new;
                        println!("{} matches {}", i, j);
                        already_joined.insert(j);
                        break 'outer;
                    }
                }
            }
        }
    }
    return total;
}
